{"ast":null,"code":"import NetworkError from './NetworkError';\nconst SERVICE_TOKEN_NAME = 'serviceToken';\nlet networkErrorCallback;\nlet reauthenticationCallback;\n\nconst isJson = response => {\n  const contentType = response.headers.get(\"content-type\");\n  return contentType && contentType.indexOf(\"application/json\") !== -1;\n};\n\nconst handleOkResponse = (response, onSuccess) => {\n  console.log(response);\n\n  if (!response.ok) {\n    return false;\n  }\n\n  if (!onSuccess) {\n    console.log(\"A\");\n    return true;\n  }\n\n  if (response.status === 204) {\n    onSuccess();\n    return true;\n  }\n\n  onSuccess(response);\n  return true;\n};\n\nconst handle4xxResponse = (response, onErrors) => {\n  if (response.status < 400 || response.status >= 500) {\n    return false;\n  }\n\n  if (response.status === 401 && reauthenticationCallback) {\n    reauthenticationCallback();\n    return true;\n  }\n\n  if (onErrors) {\n    onErrors(response);\n  }\n\n  return true;\n};\n\nconst handleResponse = (response, onSuccess, onErrors) => {\n  if (handleOkResponse(response, onSuccess)) {\n    return;\n  }\n\n  if (handle4xxResponse(response, onErrors)) {\n    return;\n  }\n\n  if (onErrors) {\n    onErrors(response);\n  }\n};\n\nexport const init = callback => networkErrorCallback = callback;\nexport const setReauthenticationCallback = callback => reauthenticationCallback = callback;\nexport const setServiceToken = serviceToken => sessionStorage.setItem(SERVICE_TOKEN_NAME, serviceToken);\nexport const getServiceToken = () => sessionStorage.getItem(SERVICE_TOKEN_NAME);\nexport const removeServiceToken = () => sessionStorage.removeItem(SERVICE_TOKEN_NAME);\nexport const config = (method, body) => {\n  const config = {};\n  config.method = method;\n\n  if (body) {\n    if (body instanceof FormData) {\n      config.body = body;\n    } else {\n      config.headers = {\n        'Content-Type': 'application/json'\n      };\n      config.body = JSON.stringify(body);\n    }\n  }\n\n  let serviceToken = getServiceToken();\n\n  if (serviceToken) {\n    if (config.headers) {\n      config.headers['Authorization'] = `Bearer ${serviceToken}`;\n    } else {\n      config.headers = {\n        'Authorization': `Bearer ${serviceToken}`\n      };\n    }\n  }\n\n  return config;\n};\nexport const appFetch = (path, options, onSuccess, onErrors) => fetch(`${process.env.REACT_APP_BACKEND_URL}${path}`, options).then(response => handleResponse(response, onSuccess, onErrors)).catch(networkErrorCallback);","map":{"version":3,"sources":["C:/Users/ruzaf/Desktop/ws/elevator-app/src/backend/appFetch.js"],"names":["NetworkError","SERVICE_TOKEN_NAME","networkErrorCallback","reauthenticationCallback","isJson","response","contentType","headers","get","indexOf","handleOkResponse","onSuccess","console","log","ok","status","handle4xxResponse","onErrors","handleResponse","init","callback","setReauthenticationCallback","setServiceToken","serviceToken","sessionStorage","setItem","getServiceToken","getItem","removeServiceToken","removeItem","config","method","body","FormData","JSON","stringify","appFetch","path","options","fetch","process","env","REACT_APP_BACKEND_URL","then","catch"],"mappings":"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","sourcesContent":["import NetworkError from './NetworkError';\r\n\r\nconst SERVICE_TOKEN_NAME = 'serviceToken';\r\n\r\nlet networkErrorCallback;\r\nlet reauthenticationCallback;\r\n\r\nconst isJson = response => {\r\n\r\n    const contentType = response.headers.get(\"content-type\");\r\n\r\n    return contentType && contentType.indexOf(\"application/json\") !== -1;\r\n\r\n}\r\n\r\nconst handleOkResponse = (response, onSuccess) => {\r\n    console.log(response)\r\n    if (!response.ok) {\r\n        return false;\r\n    }\r\n\r\n    if (!onSuccess) {\r\n        console.log(\"A\");\r\n\r\n        return true;\r\n    }\r\n    if (response.status === 204) {\r\n        onSuccess();\r\n        return true;\r\n    }\r\n\r\n    onSuccess(response);\r\n\r\n    return true;\r\n\r\n}\r\n\r\nconst handle4xxResponse = (response, onErrors) => {\r\n\r\n    if (response.status < 400 || response.status >= 500) {\r\n        return false;\r\n    }\r\n\r\n    if (response.status === 401 && reauthenticationCallback){\r\n        reauthenticationCallback();\r\n        return true;\r\n    }\r\n\r\n\r\n    if (onErrors) {\r\n        onErrors(response);\r\n    }\r\n\r\n    return true;\r\n\r\n}\r\n\r\nconst handleResponse = (response, onSuccess, onErrors) => {\r\n\r\n    if (handleOkResponse(response, onSuccess)) {\r\n        return;\r\n    }\r\n\r\n    if (handle4xxResponse(response, onErrors)) {\r\n        return;\r\n    }\r\n\r\n    if(onErrors) {\r\n        onErrors(response);\r\n    }\r\n    \r\n}\r\n\r\nexport const init = callback => networkErrorCallback = callback;\r\n\r\nexport const setReauthenticationCallback = callback => reauthenticationCallback = callback;\r\n\r\nexport const setServiceToken = serviceToken => \r\n    sessionStorage.setItem(SERVICE_TOKEN_NAME, serviceToken);\r\n\r\nexport const getServiceToken = () => sessionStorage.getItem(SERVICE_TOKEN_NAME);\r\n\r\nexport const removeServiceToken = () => \r\n    sessionStorage.removeItem(SERVICE_TOKEN_NAME);\r\n\r\nexport const config = (method, body) => {\r\n\r\n    const config = {};\r\n\r\n    config.method = method;\r\n\r\n    if (body) {\r\n        if (body instanceof FormData) {\r\n            config.body = body;\r\n        } else  {\r\n            config.headers = {'Content-Type': 'application/json'};\r\n            config.body = JSON.stringify(body);\r\n        }\r\n    }\r\n\r\n    let serviceToken = getServiceToken();\r\n\r\n    if (serviceToken) {\r\n\r\n        if (config.headers) {\r\n            config.headers['Authorization'] = `Bearer ${serviceToken}`;\r\n        } else {\r\n            config.headers = {'Authorization': `Bearer ${serviceToken}`};\r\n        }\r\n\r\n    }\r\n\r\n    return config;\r\n\r\n}\r\n\r\nexport const appFetch = (path, options, onSuccess, onErrors) =>\r\n    fetch(`${process.env.REACT_APP_BACKEND_URL}${path}`, options)\r\n        .then(response => handleResponse(response, onSuccess, onErrors))\r\n        .catch(networkErrorCallback);\r\n"]},"metadata":{},"sourceType":"module"}